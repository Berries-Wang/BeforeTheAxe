# 从Maven 命令格式来理解Maven的生命周期和插件
## 1. 什么是Maven的生命周期
1. Maven的实际构建动作都是由插件来完成的。

&nbsp;&nbsp;Maven的生命周期就是为了对所有的构建过程进行抽象和统一。Maven从大量项目和构建工具中学习和反思，然后总结了一套高度完善的，易扩展的生命周期。这个生命周期包括了项目的清理、初始化、编译、测试、打包、集成测试、验证、部署和站点生成等几乎所有的构建步骤。换句话说 几乎所有的项目的构建，都能**映射**到这样一个生命周期上。
   - 即 类似于摸板方法

&nbsp;&nbsp;Maven的生命周期是抽象的，这意味着生命周期本身不做任何实际的工作，在Maven的设计中，实际的任务(如编译源代码)都交由插件来完成。这种思想和设计模式中的模板方法类似。模板方法模式在父类中定义了算法的整体结构，自雷可以通过实现或者重写父类的方法来控制实际的行为，这样既保证了算法有足够的可拓展性，又能够严格控制算法的整体结构   
```java
    public abstract class AbstraceBuild{

        public void build(){
            initialize();
            compile();
            test();
            packagee();
            integrationTest();
            deploy();
        }

        protect abstract void initialize();
        protect abstract void compile();
        protect abstract void test();
        protect abstract void packagee();
        protect abstract void integrationTest();
        protect abstract void deploy();

    }
```
- 这段代码很简单，build()方法定义了整个构建的过程，依次初始化、编译、测试、打包、集成测试和部署，但是这个类中没有具体的实现逻辑，他们都交由子类去实现。
- 虽然上述代码和Maven的实际代码相去甚远，Maven的生命周期包含更多的步骤和更复杂的逻辑，但是没有提供具体实现，那么谁来实现这些步骤呢? 因此，**Maven设计了插件机制。每个构建步骤都可以绑定一个或多个插件行为**，而且Maven为大多数构建步骤编写并绑定了默认的插件。例如，针对于编译插件有 maven-compiler-plugin,针对于测试插件 maven-surefire-plugin等。虽然在大多数时间中，用户几乎都不会察觉到插件的存在，但实际上编译是由maven-compiler-plugin完成的，而测试是由 maven-surefire-plugin完成的。当用户有特殊需要的时候，也可以配置插件定制构建行为，甚至自己编写插件。
   - 生命周期和插件的关系: <img src="./pics/maven-plugin-life-001.png"/>
   - Maven定义的生命周期和插件机制一方面保证了所有Maven项目对有一致的构建标准，另一方面又通过默认插件简化和稳定了实际项目的构建。此外，该机制还提供了足够的扩展空间，用户可以通过配置现有插件或者自行编写插件来自定义构建行为

## 2. [Maven生命周期详解](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)
&nbsp;&nbsp; Maven有三套相互独立的生命周期，分别为:
1. clean: clean生命周期的目的是清理项目
2. default: default生命周期的目的是构建项目
3. site: site生命周期的目的是建立项目站点

&nbsp;&nbsp;每一个生命周期包含一些阶段(**phase,即对应mvn命令中的phase(s)**)，这些阶段都是有顺序的，并且后面的阶段依赖于前面的阶段，用户和Maven最直接的交互方式就是调用这些生命周期阶段。以clean生命周期为例子，clean生命周期包含的阶段: pre-clean 、 clean 、 post-clean。当用户：
  - 调用pre-clean的时候，只有pre-clean阶段得以执行。
  - 调用clean的时候，pre-clean,clean阶段会得以顺序执行
  - 调用post-clean时，pre-clean、clean、post-clean会得以顺序执行。

&nbsp;&nbsp;较之于生命周期阶段的前后依赖关系，三套生命周期本身是相互独立的，用户可以仅仅调用clean生命周期的某一个阶段，或者仅仅调用default生命周期的某一个阶段而不会对其他生命周期产生任何影响。

### 2-1. clean生命周期
&nbsp;&nbsp;clean生命周期的目的是清理项目，包含三个阶段:
1. pre-clean: 执行一些清理前所需要完成的工作
2. clean: 清理上一次构建生成的文件
3. post-clean: 执行一些清理后需要完成的工作。

### 2-2.default生命周期
&nbsp;&nbsp;default生命周期定义了真正构建时所需要执行的所有步骤，他是所有生命周期中最核心的部分，包含的阶段如下:




----------------
## 3. Maven的命令格式
&nbsp;&nbsp;如下图: <img src="./pics/mvn-command-001.png"/>

&nbsp;&nbsp;通过如上截图，可以看出，maven的命令格式:
+ mvn [options] [<goal(s)>] [<phase(s)>]
   1. options: 如mvn --help输出的，这里不做赘述
   2. goal(s): 即插件目标. 在maven插件的主页搜索Goals Overview,可以知道插件的goal.如下图: 
       - <img src="./pics/mvn-command-002.png" />
       - 链接:[http://maven.apache.org/archetype/maven-archetype-plugin/](http://maven.apache.org/archetype/maven-archetype-plugin/)
   3. phase(s): 即Maven的生命周期
